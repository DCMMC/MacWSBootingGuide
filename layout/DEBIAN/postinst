cd $(realpath $HOME/../..)/usr/macOS

add_trustcache() {
    local path="$1"
    local cdhash
    cdhash=$(ldid -arch arm64 -h "$path" 2>/dev/null | grep CDHash= | cut -c8-)
    if [ -n "$cdhash" ]; then
        echo "Adding $path cdhash: $cdhash"
        jbctl trustcache add "$cdhash"
    fi
}

add_arm64e_trustcache() {
    local path="$1"
    local cdhash
    cdhash=$(ldid -arch arm64e -h "$path" 2>/dev/null | grep CDHash= | cut -c8-)
    if [ -n "$cdhash" ]; then
        echo "Adding $path cdhash: $cdhash"
        jbctl trustcache add "$cdhash"
    fi
}

add_x86_64_trustcache() {
    local path="$1"
    local cdhash
    cdhash=$(ldid -arch x86_64 -h "$path" 2>/dev/null | grep CDHash= | cut -c8-)
    if [ -n "$cdhash" ]; then
        echo "Adding $path cdhash: $cdhash"
        jbctl trustcache add "$cdhash"
    fi
}

add_all_trustcache() {
    local path="$1"
    add_trustcache $1
    add_arm64e_trustcache $1
    add_x86_64_trustcache $1
}

add_trustcache "bin/login"
add_trustcache "bin/TestMetalIOSurface"
add_all_trustcache "lib/libmachook.dylib"
add_all_trustcache "bin/launchdchrootexec"
add_all_trustcache "bin/launchdchrootexec_debug"
add_all_trustcache "Frameworks/MetalSerializer.framework/MetalSerializer"
add_all_trustcache "Frameworks/MTLSimDriver.framework/MTLSimDriver"
add_all_trustcache "Frameworks/MTLSimImplementation.framework/MTLSimImplementation"
# codesign -vvv -d dyld_shared_cache_arm64e 2>&1 | grep CDHash=
# jbctl trustcache add b5da39409492ac85e5a8e8ab618fe77e2d7a2980
# codesign -vvv -d dyld_shared_cache_arm64e.01 2>&1 | grep CDHash=
# jbctl trustcache add bbb765988e2677b98d47a549d612fa0d4af25f69
# add_all_trustcache "/var/mnt/rootfs/bin/bash"
# add_all_trustcache "/var/mnt/rootfs/System/Library/CoreServices/launchservicesd"
# add_all_trustcache "/var/mnt/rootfs/System/Library/CoreServices/launchservicesd.dylib"
# add_all_trustcache "/var/mnt/rootfs/System/Library/PrivateFrameworks/SkyLight.framework/Resources/WindowServer_arm64"
# add_all_trustcache /var/mnt/rootfs/var/jb/usr/macOS/Frameworks/MTLSimImplementation.framework/MTLSimImplementation
# add_all_trustcache /var/mnt/rootfs/usr/local/lib/libmachook.dylib
# add_all_trustcache /var/mnt/rootfs/var/jb/usr/macOS/Frameworks/MetalSerializer.framework/MetalSerializer
# add_all_trustcache /var/mnt/rootfs/var/jb/usr/macOS/Frameworks/MTLSimDriver.framework/MTLSimDriver
# add_all_trustcache /var/mnt/rootfs/usr/lib/dyld
# add_all_trustcache /var/jb/usr/macOS/bin/launchdchrootexec
# add_all_trustcache /var/mnt/rootfs/var/jb/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate
# add_all_trustcache /var/mnt/rootfs/System/Library/Frameworks/CydiaSubstrate.framework/CydiaSubstrate
# add_all_trustcache /var/mnt/rootfs/System/Tweaks/TweakLoader.dylib
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/ServicePlugins/IOHIDEventServicePlugin.plugin/Contents/MacOS/IOHIDEventServicePlugin
# add_all_trustcache "/var/mnt/rootfs/System/Library/CoreServices/Installer Progress.app/Contents/MacOS/Installer Progress"
# add_all_trustcache /var/mnt/rootfs/usr/lib/systemhook.dylib
# add_all_trustcache /var/mnt/rootfs/private/var/jb/usr/lib/libroot.dylib
# add_all_trustcache /var/mnt/rootfs/System/Library/PrivateFrameworks/SkyLight.framework/Versions/A/Resources/CursorAsset
# add_all_trustcache /var/mnt/rootfs/System/Library/PrivateFrameworks/SkyLight.framework/Versions/A/Resources/CursorAsset_base
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/AppleSPUHIDStatistics.plugin/Contents/MacOS/AppleSPUHIDStatistics
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/IOHIDEventSystemStatistics.plugin/Contents/MacOS/IOHIDEventSystemStatistics
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/IOHIDNXEventTranslatorSessionFilter.plugin/Contents/MacOS/IOHIDNXEventTranslatorSessionFilter
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/IOHIDDFREventFilter.plugin/Contents/MacOS/IOHIDDFREventFilter
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/SessionFilters/IOHIDRemoteSensorSessionFilter.plugin/Contents/MacOS/IOHIDRemoteSensorSessionFilter
# add_all_trustcache /var/mnt/rootfs/System/Library/HIDPlugins/SessionFilters/IOAnalytics.plugin/Contents/MacOS/IOAnalytics
# add_all_trustcache /var/mnt/rootfs/System/Library/CoreServices/TouchBarEvent.bundle
# add_all_trustcache /var/mnt/rootfs/System/Library/PrivateFrameworks/GPUCompiler.framework/Versions/31001/Libraries/libGPUCompiler.dylib
# add_all_trustcache /var/mnt/rootfs/usr/local/Frameworks/MetalSerializer.framework/MetalSerializer
# add_all_trustcache /var/mnt/rootfs/System/Applications/Utilities/Terminal.app/Contents/MacOS/Terminal
# add_all_trustcache /var/mnt/rootfs/usr/local/lib/.jbroot/usr/lib/libroot.dylib